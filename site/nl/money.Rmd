---
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    anchor_sections: false
---

<br>

```{r global, include=FALSE, echo=F, context="setup", results='hide'}


library(flexdashboard)
knitr::opts_chunk$set(echo = F, message = F, warning = F)

library(shiny)
library(janitor)
library(DT)
library(magrittr)
library(glue)
library(highcharter)
library(lubridate)
library(knitr)
library(tidyverse)
library(htmltools)
library(shinyWidgets)




# snap_ads <- readRDS("data/snap_ads.RDS")
# 
trans <- readRDS("../data/trans_dutch.rds")
# trans <- readRDS("../data/trans_eng.rds")


source("../../R/helpers.R")
source("../../R/dashboard_data.R")



```



## Total Spent {.tabset .tabset-fade .tabset-pills}

### Facebook Platforms (incl. Instagram) {.tabset .tabset-fade .tabset-pills}
#### Minimum

```{r}
  fb_aggr %>% 
    hc_plotter(filters = dutch_parties_fb,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 1),
           platform = "Facebook",
           trans_internal = trans,
           last_updated = update_time, minmax = "Minimum"
    )
```

The Facebook Ad library only provides very broad "lower" and "upper bounds" of Euros spent for an individual ad ID. In order to calculate this metric by advertiser, we use the median amount of the lower and upper bound of money spent for each unique ad (i.e., each ad with unique text and link) and sum the lower and upper bound for every advertiser. 


#### Maximum
```{r}
  fb_aggr %>% 
    hc_plotter(filters = dutch_parties_fb,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 1),
           platform = "Facebook",
           trans_internal = trans,
           last_updated = update_time, minmax = "Maximum"
    )
```

The Facebook Ad library only provides very broad "lower" and "upper bounds" of Euros spent for an individual ad ID. In order to calculate this metric by advertiser, we use the median amount of the lower and upper bound of money spent for each unique ad (i.e., each ad with unique text and link) and sum the lower and upper bound for every advertiser. 


### Google Platforms (incl. YouTube)

```{r}
  ggl_aggr %>% 
    hc_plotter(filters = dutch_parties,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 1),
           platform = "Google",
           trans_internal = trans,
           last_updated = update_time
    )
```

For Google platforms, data accessed via the [Google Transparency Report](https://transparencyreport.google.com/political-ads/region/NL) provides weekly statistics on how much money was spent by parties.
 
## Over Time Spent {.tabset .tabset-fade .tabset-pills}

### Facebook Platforms (incl. Instagram) {.tabset .tabset-fade .tabset-pills}

#### Minimum

```{r}
  fb_aggr %>% 
    hc_plotter(filters = dutch_parties_fb,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 2),
           platform = "Facebook",
           trans_internal = trans,
           last_updated = update_time, minmax = "Minimum"
    )
```

#### Maximum

```{r}
  fb_aggr %>% 
    hc_plotter(filters = dutch_parties_fb,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 2),
           platform = "Facebook",
           trans_internal = trans,
           last_updated = update_time, minmax = "Maximum"
    )
```



### Google Platforms (incl. YouTube)

```{r}
  ggl_aggr %>% 
    hc_plotter(filters = dutch_parties,
           plot_type = unlist_it(trans$choices, 2),
           plot_type_sub = unlist_it(trans$total_text, 2),
           platform = "Google",
           trans_internal = trans,
           last_updated = update_time, minmax = "Maximum"
    )
```

